# infraops_toolkit
인프라 툴킷이였지만 모니터링이랑 백업이 너무 구현할게 없어서 그냥 세큐리티 쪽으로 집중하는게 나을것 같다. 
단순히 서버 보안 체크해주는 프로그램 만드는것도 좋지만 너무 딸깍이니까 기능을 더 추가해야할듯. 

일단 `멀티서버` + `최적화` + `보안점검` 이 3가지가 키워드다

그러면 우선 해야할게 
1. 보안점검 스크립트를 다 만들기 
2. 여러 서버에 동시 접속해서 스크립트 돌리는 점검매니저를 파이썬으로 구현 (도커로 50개정도 서버에 대해 실행해보면 될듯)
3. 다 돌린 다음에 결과를 받아서 50개 서버에 대한 결과를 pdf로 뽑기 
4. 걸리는 시간을 재고 최적화를 궁리해서 10초만에 50개 서버 점검 완료했어요 같은 성능테스트 결과 발표하기 



```text
┌───────────────┐
│  서버 리스트  │  ← IP/계정/SSH키
└─────┬─────────┘
      │
      ▼
┌────────────────────────────┐
│     점검 매니저 (Python)      │
│  - asyncio + asyncssh      │
│  - 각 서버에 동시에 접속        │
│  - 점검 스크립트 실행           │
│  - 결과 JSON 수집             │
└─────┬──────────────────────┘
      │
      ▼
┌────────────────────┐
│   결과 수집 / 통합 │
│ - JSON -> pandas   │
│ - 통계, 요약 생성  │
└─────┬──────────────┘
      │
      ▼
┌───────────────────┐
│  HTML / PDF 리포트 │
└───────────────────┘
```

***
일단 보안 스크립트 끝까지 만들기 완료했다. 
앞으로 해야하는건 
1. 점검 스크립트 다시 보면서 수정하기
    - 쭉 읽어보고 잘못 짠 곳은 없는지 확인하고 
    - 더 잘 짤 수 있는게 있을지 확인하고 
    - U_20이전에 결과에 경고도 포함시킬 수 있으면 취약을 경고로 바꾸기 
    - 비슷한 유형의 보안 점검을 같이 묶어서 실행하기 
2. 결과 보고서 파일 만드는 함수 만들기 
    - 일단은 하나의 서버에 대해 만들고 나중에 여러 서버의 결과를 다 합친 최종본을 만드는 느낌? 

` pandoc report.md -o report.pdf -V mainfont="NanumGothic" --pdf-engine=xelatex`으로 pdf변환하고
`kimkihyun$ scp -i ~/Desktop/linux/mypem.pem ec2-user@13.238.197.137:/home/ec2-user/infraops_toolkit/reports/report.pdf ~/Downloads/`으로 복사해서 확인 가능함  

***
##보고서 형식 
```text

==============================================
        서버 보안 감사 보고서
==============================================

        작성일: 2025-09-17
        점검 대상: EC2 Apache 서버 (ip : 192.168.0.1)
        작성자: 김기현




1. 점검목적 
    본 부서에서 관리하는 50대의 리눅스 서버에 대해 보안관리가 제대로 이루어지고 있는지 점검하는걸 목적으로 한다. 

2. 점검 결과 요약 
    총 점검항목 40건에 대한 점검 결과를 표1에 요약하였다. 

        점검 결과   건수        상세 항목 
        안전        2건        U-10,U-12
        경고        1건         U-14
        취약        1건         U-40

3. 상세 점검 결과 
    점검 내용: 
    점검 기준: 
        -양호 : 
        -취약 :
        -점검불가 : 
    점검 결과: 

4. 취약 항목 요약 및 조치 
## U_02   
- 상황: 패스워드 복잡성 설정이 완료된 상태  
- 조치:   
...
이거 

이거 하나의 U-01에도 여러 갈래로 조치가 달라지고 같은 취약이라도 조치법이 달라지니까 어떤식으로 매핑할지가 관건인데 
단순 에러코드 반환? 모든 케이스에 대해 에러코드와 표를 미리 만들어놓고 그걸 참고하면서 하는 식으로 할까 
사용자 입장에선 괜찮은데 유지보수 입장에선 애매하려나? 아닌가 오히려 좋을지도 ok이렇게 해보자. 






```
scp root@192.168.151.79:/root/audit_files/scripts/test.pdf "C:\Users\KIM KIHYUN"

이제 ./gene.. 프로그램 돌리면 바로 pdf 파일까지 만들어지게 함. 
이걸 
scp -i "C:\Users\KIM KIHYUN\Desktop\linux\mypem.pem" `
>> ec2-user@13.238.197.137:/home/ec2-user/infraops_toolkit/scripts/report_251115_072556.pdf `
>> "C:\Users\KIM KIHYUN\\"
이런 식으로 리눅스서버에서 데스크탑으로 다운받고 확인해보면 pdf가 대충 만들어진 걸 볼 수 있음. 
이제 해야하는게 
1. 더 보고서를 보기 쉽게 바꿔야 할듯. 라텍스 사용 가능한건 알았는데 이걸로 다 바꾸는건 개 빡일듯 한데... 그냥 이걸로 바꿔볼까.. 색같은거도 바꾸면 좋을거 같고 각 챕터마다 다음 페이지로 넘어가게 설정하던지.. 
2. 이걸 단순히 실행하고 잘 나왔네요로는 뭔가 시각적인 자극이 부족하긴 함. 이걸 좀 더 프로그램 스럽게 바꿔야 하는데 예를들어 웹사이트에서 서버 정보 넣으면 보고서 다운받을 수 있게 만든다던지, 아니면 리눅스 프로그램으로 한다던지 근데 윈도우가 아니라 gui좀 빡세지 않나? gui리눅스 프로그램으로 만들어야 하나..좀 찾아봐야 할듯 

--> 이거.. gui는 이사람 웹/앱 개발자라는 인식을 줄 수도 있고, tui도 솔직히 모르는 사람 입장에서 보면 열라 있어보여서 오히려 더 시각적으로 자극적일 수도 있음. 따라서 tui로 간다. 
일단 이거 만드는걸 목표로 하고, PyInstaller가 1단계로 이정도만 해도 충분함. 프로그램으로 인정해줌. 근데 좀 더 가자면
pip install로 깔 수 있게 PyPI에 업로드가 더 좋겠지. 여기서 좀 더 가면 yum으로 설치 가능하거나 그런거고. 





mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
리눅스 서버에서 tmi프로그램을 다운 받았을때 같이 다운받아야 하는 패키지들 
1. textual 
python3 -m pip install --upgrade pip로 pip업데이트 하고 
python3 -m pip install textual로 설치해야함 

2.paramiko
python3 -m pip install paramiko

3. xelatex
sudo dnf install texlive-xetex
sudo dnf install texlive-ucharcat texlive-xetex



***
lastlog
일단 pdf를 생성하는거까진 했는데 문제는 파일 이름에 이상한 글자가 들어가있어서 이걸 제거하는 수순이 필요할듯. 
그리고 이걸 윈도우에서 보니까 취약항목같은 몇몇 변수들에 값이 안들어가있는 문제가 있는데 이거 왜 이런지 해결해야 할듯 
